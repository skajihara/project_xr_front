# タスク一覧

## ＜上から順に消化していこう＞

- 基本画面を実装する（あとはプロフィール画面）：✅
- 全ての画面遷移をappRouterに置き換える：✅
- APIによるデータ取得を全てhooksに移行する：✅
- データ型の定義をtypesフォルダに整理してインポートして使うよう修正する：✅
- 予約ツイートしたら予約ツイート一覧を最新データで再描画する：✅
- 404 Not Found ページ：✅
- 自分のツイート編集削除機能実装：✅
- hooksをSWR＋suspenseモードに書き換え：✅
- テスト環境セットアップ（Jest + React Testing Library）：✅
- フックの単体テストを作成する：✅
- コンポーネントの単体テストを作成する：✅
- 最低限のスタイリング（labelやidを設定）：✅
- テストを修正する：✅
- APIの呼び出しがパラメータとパス変数で別れている（db.jsonのせい）からサーバと連携したら全てパス変数に統一する：

---

# コンポーネントテストの方針

| 種類              | 目的                          | 例                        |
| :---------------- | :----------------------------- | :------------------------ |
| **レンダリングテスト** | 正しく画面に要素が表示されるか確認       | タイトルやボタンがあるか？           |
| **イベントテスト**    | ユーザー操作に対して正しい動作をするか確認  | ボタン押したら画面遷移するか？         |
| **副作用テスト**     | データ取得・送信・ストア更新とか裏で何か起きるか確認 | フォーム送信でfetchされるか？          |

## テスト手順
1. レンダリングテストだけ先に作る
2. ユーザー操作（イベント）テストを追加する
3. 必要なら副作用（fetch呼び出し・store更新）テストも追加する

---

# テスト優先度

| ファイル                                                                 | 役割                  | 優先テスト対象？         |
| :--------------------------------------------------------------------- | :------------------ | :--------------- |
| `Timeline`, `ProfileTweets`, `MyTweetSchedule`                         | **リスト系**            | ✅（データフェッチ＋リスト表示） |
| `TweetForm`, `ScheduleTweetForm`                                       | **フォーム系**           | ✅（入力→submit系）    |
| `TweetCard`, `ScheduledTweetCard`                                      | **カードUI**           | ✅（単体表示確認できる）     |
| `TweetDetail`, `ScheduledTweetDetail`                                  | **詳細画面＋編集削除ロジックあり** | ✅（イベント検証アリ）      |
| `ProfileHeader`, `RecommendedUsers`, `TrendTopics`                     | **プロフィール・サイド表示**    | ✅（データフェッチ検証）     |
| `MyProfile`, `SideMenu`                                                | **ログアウト・リンク機能あり**   | ✅（イベント検証できる）     |
| `AuthWrapper`, `CenterArea`, `LeftArea`, `RightArea`, `NotFoundClient` | **レイアウト・ラッパー系**     | △（基本は後回しで）     |

---

# テスト作成ポリシー

- 画面に出る
- 独立してテストしやすい
- ロジックがあるコンポーネントを優先する
- レイアウトラッパー系は後回し
- react-error-boundaryはEMSをサポートしていないため、コンポーネントの単体テストはjestではなくVitestで作成する

---

# テスト作成順序

- リスト系：✅
- フォーム系：✅
- カードUI：✅
- 詳細画面・編集削除ロジック：✅
- プロフィール・サイド表示：✅
- ログアウト・リンク機能：✅
- レイアウト・ラッパー系：保留

---

# リスト系テスト観点

- それぞれフェッチ成功してリストが表示されるか
- フェッチ失敗時のエラー表示確認
- 空リストなら「まだツイートがないよ」表示があるならそれも確認

---

# フォーム系テスト観点

- フォームが正しく描画されるか（placeholderとボタン）
- 空投稿でエラーが表示されるか
- 正常投稿時にfetchとwindow.location.reloadが呼ばれるか
- fetch失敗時にエラーが表示されるか

---

# カードUIテスト観点

- アカウントID・日時・テキストの表示
- アイコン画像の表示（icon が null の場合はデフォルト）
- 各カウンター（いいね・リツイート・返信・閲覧）が正しく表示されてるか
- クリックで router.push が正しく呼ばれる（ツイート or プロフィール）

---

# 詳細画面・編集削除ロジックテスト観点

### 表示系の観点（静的検証）
- ツイート詳細（TweetCard）が表示される
- ログイン中のユーザーがツイート主でない場合 → 編集・削除ボタンが表示されない
- ログイン中のユーザーがツイート主である場合 → 編集・削除ボタンが表示される
- 編集モード時 → フォーム要素（textarea, input, ボタン類）が正しく表示される
- 初期フォーム値がツイートの内容と一致している

### 編集系の観点（入力検証＋API通信）
- 空のテキストで保存を試みるとエラーメッセージが出る
- 正常な編集内容で保存 → fetch(PUT) が呼ばれる＋reload()される
- 編集 → キャンセルボタンで編集モード解除される
- 編集時に fetch(PUT) が失敗 → エラーメッセージ表示

### 削除系の観点（操作と副作用）
- 削除ボタン押下 → confirm が呼ばれる
- confirm が true の場合 → fetch(DELETE) が呼ばれ router.push('/home') が呼ばれる
- confirm が false の場合 → fetch や router.push は呼ばれない
- 削除失敗時 → alert が表示される

---

# プロフィール・サイド表示テスト観点

### プロフィールヘッダー
- account 情報とアイコン画像とヘッダー画像がすべて正しく表示されること
- account.icon が空文字や null の場合 → /icons/account/default_icon.svg が使われること
- 戻る ボタンと フォロー中 ボタンが存在すること
- 戻る ボタンクリックで router.push('/home') が呼ばれる
- account が null の場合に notFound() が呼ばれる

### トレンドトピックス
- トレンドデータが全件表示されていること
- カテゴリ・トピック名・ツイート数が正しく表示されていること

### おすすめユーザー
- 現在のユーザー（useUserStore）を除外して表示されること
- 最大5件まで表示されること
- ユーザー名・アカウントIDが表示されてること
- ユーザーアイコンが表示される（icon が null や空文字のときはデフォルト）

---

# ログアウト・リンク機能
- 表示要素の確認
- ユーザー操作による副作用（遷移・ステート更新）
- フックの異常系ハンドリング

---

# 注意事項

どうやらプロジェクト特有の問題で、jestでもvitestでもコンポーネントの単体テストが成功しないらしい。
Next.js App Router + SWR（suspense: true）構成だと、"ただレンダリングすれば終わり"ではない。
- suspense解除待ちが必要だが
- useSWRのPromise内部を強制同期化　または　Suspense fallbackからresolveされるまで待機
- テストコードでact()管理する必要がある
- `ErrorBoundaryをモックしてしまえば良い`

---

# スタイリング方針

- テスト壊さず、責務分離して、Twitter風のUIをCSSでリッチ化
    - ChakraUIみたいなコンポーネントスタイルライブラリだと既存テストやDOM構造が崩れる危険大
    - Chakraとmodule.css併用はスタイルがバラけてカオスになる
- ここまで来たらmodule.cssのみでやるしかない
    - global.css → アプリ全体の背景やフォントなどだけに使う
    - *.module.css → 各コンポーネントに責任範囲限定のCSSを割り当てる
- **ライブラリを導入するならテスト作成前が良かった（反省点）**

### 共通パーツのリッチ化（カード・ボタン・フォーム）

- 目的：UIの型を整える（個別ページやエリアに関係なく使われる共通部品のリッチ化）
- 対象：
    - TweetCard.tsx、ScheduledTweetCard.tsx
    - ボタン（投稿・編集・削除ボタンなど）
    - フォーム（TweetForm / ScheduleTweetForm）
- やること：
    - TweetCard.module.css → シャドウ、ホバー、余白
    - Button.module.css → primary、danger、disabledなど状態別クラス
    - FormField.module.css → label、input、textareaの統一スタイル

### 3エリア（Left / Center / Right）のビジュアル強化

- 目的：ページ構成に合わせたエリアごとの視認性とバランス調整（各エリアで表示される情報の意味を視覚的に分離）
- 対象：
    - LeftArea.module.css
    - CenterArea.module.css
    - RightArea.module.css
- やること：
    - 背景の色の差（白 / グレー）
    - 高さ・パディング・ボーダー調整
    - スクロールの独立（overflow-y）

### ページ単位のスタイル補強（Timeline, Profile, Scheduleなど）

- 目的：ページ単体でのセクション分けや情報の見せ方強化（フォームやカードの周囲に適切な余白を設ける）
- 対象：
    - Tmeline.tsx
    - ProfileTweets.tsx
    - MyTweetSchedule.tsx など

### 補助エリア（RightArea内のトレンド・おすすめ）整備

- 目的：RecommendedUsers.tsx や TrendTopics.tsx の情報が浮かないよう調整

### スクロールエリアの変更
```
<body>
  └─ <AuthWrapper> ← 全体で1スクロール
        └─ layoutWrapper (flex)
             ├─ leftArea（固定・スクロールしない）
             └─ scrollArea（← 中央＆右をまとめる）
                    ├─ centerArea
                    └─ rightArea
```

### Tailwindの排除（インストールしておらず無効のため）

##### まだスタイリングしてないコンポーネント

- AuthPage.tsx ログインフォーム系
- MyProfile.tsx	LeftAreaのプロフィール表示
- NotFoundClient.tsx 404ページ
- SideMenu.tsx メニュー一覧

##### Tailwind記法が含まれるコンポーネント
- AuthPage.tsx フォーム全体が Tailwind ベース
- MyProfile.tsx	レイアウトやアイコンサイズ等
- NotFoundClient.tsx 中央寄せや文字色などがTailwind
- SideMenu.tsx ナビゲーション構成

### レスポンシブ対応（表示の最適化）

- 目的：表示領域のサイズを変更しても快適に見られるUIへ調整（左 or 右カラムを非表示など）
